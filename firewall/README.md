# Ansible Firewall Configuration Role

Эта роль Ansible автоматически настраивает правила файервола (открытие определенных портов и сервисов) на целевых хостах. Она определяет, используется ли `firewalld` или `ufw`, и применяет конфигурацию с помощью соответствующего инструмента.

## Возможности

* Автоматическое определение активного файервола (`firewalld` или `ufw`).
* Настройка правил на основе списка разрешенных портов и сервисов.
* Поддержка указания файервола по умолчанию, если ни один не активен.
* Идемпотентность: выполнение роли повторно не должно приводить к нежелательным изменениям.

## Поддерживаемые платформы

Роль протестирована на:

* **AlmaLinux 8**, где `firewalld` является файерволом по умолчанию.

## Требования

* Ansible версии 2.9 или выше.
* Для управления `ufw` требуется коллекция `community.general`. Установите ее с помощью команды:

    ```bash
    ansible-galaxy collection install community.general
    ```

* Пользователь Ansible должен иметь привилегии `become` (sudo) для управления службами и правилами файервола.

## Переменные роли

Основные переменные определены в `defaults/main.yml`:

| Переменная                     | Описание                                                                                                | Тип   | Значение по умолчанию                |
| :----------------------------- | :-------------------------------------------------------------------------------------------------------- | :---- | :----------------------------------- |
| `firewall_ports`       | Список TCP/UDP портов для открытия. Формат элемента: `"порт/протокол"` (например, `"22/tcp"`) или `"порт"` (по умолчанию TCP). | list  | `["22/tcp", "80/tcp", "443/tcp"]`    |
| `firewall_services`    | Список стандартных имен сервисов для открытия (например, "ssh", "http", "https").                               | list  | `["ssh", "http", "https"]`           |
| `firewall_default_if_none`     | Какой файервол установить и включить, если на хосте не обнаружено ни `firewalld`, ни `ufw` в активном состоянии. Возможные значения: `'firewalld'`, `'ufw'`, `'none'` (не выполнять никаких действий, если файервол не активен).| string| `'firewalld'`|

Вы можете переопределить эти переменные в вашем плейбуке, инвентаре, group\_vars или host\_vars.

## Использование

Пример использования роли в плейбуке:

```yaml
---
- name: Применить конфигурацию файервола
  hosts: your_servers # Замените на вашу группу хостов
  become: yes         # Требуется повышение привилегий

  roles:
    - your_firewall_role # Укажите путь к вашей роли, если она не в стандартном месте
